#!/usr/bin/env node
const fs = require('fs');
const path = require('path');

const root = path.resolve(__dirname, '..');
const dataPath = path.join(root, 'src', 'data', 'legacy-mapping.json');
const outputPath = path.join(root, 'src', 'js', 'legacy-mapping.js');

function main() {
  if (!fs.existsSync(dataPath)) {
    throw new Error(`Missing legacy mapping data at ${dataPath}`);
  }
  const raw = fs.readFileSync(dataPath, 'utf8');
  const parsed = JSON.parse(raw);
  const banner = '/* Auto-generated by scripts/update-legacy-mapping.js. Do not edit manually. */\n';
  const mappingLiteral = JSON.stringify(parsed, null, 2);
  const content = `${banner}(function (global) {\n  const mapping = ${mappingLiteral};\n  if (global) {\n    global.LEGACY_MAPPING = mapping;\n  }\n  if (typeof module !== 'undefined' && module.exports) {\n    module.exports = mapping;\n  }\n})(typeof window !== 'undefined' ? window : (typeof globalThis !== 'undefined' ? globalThis : undefined));\n`;
  fs.writeFileSync(outputPath, content, 'utf8');
}

main();
